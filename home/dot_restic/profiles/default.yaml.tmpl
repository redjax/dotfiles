# yaml-language-server: $schema=https://creativeprojects.github.io/resticprofile/jsonschema/config.json
---
version: "1"

###
# This is a basic default profile I use that's kind of a
# bare-minimum for all of my machines, and the starting point for
# other profiles.
#
# To use this profile as-is, copy it to {{ .chezmoi.homeDir }}/profiles.yaml,
# or pass it with `resticprofile -c /path/to/default.yaml`
###

global:
  default-command: backup
  initialize: true
  priority: low
  min-memory: 100

groups:
  full-backup:
    - home
  
  userland:
    - home

default:
  ## Path must exist. If you don't want to run resticprofile as root,
  #  make sure it's owned by the user running resticprofile, i.e.
  #  chmod 700 /opt/restic  (if repository is /opt/restic/repo)
  repository: "local:/opt/restic/repo"
  ## Create a password with:
  #    $> resticprofile generate --random-key $KEY_LENGTH > /path/to/restic.key
  password-file: ""
  default-command: snapshots
  initialize: false
  priority: low
  min-memory: 100

  ## Define backup retention policy
  #  https://creativeprojects.github.io/resticprofile/schedules/index.html
  forget:
    keep-last: 2
    keep-hourly: 24
    keep-daily: 7
    keep-weekly: 4
    keep-tag:
      - forever
    prune: true

  ## Define pruning policy
  #  https://creativeprojects.github.io/resticprofile/reference/profile/prune/index.html
  prune:
    schedule: "weekly"
    schedule-permission: "auto"

  ## Backup operation defaults
  #  https://creativeprojects.github.io/resticprofile/reference/profile/backup/index.html
  backup:
    verbose: false
    one-file-system: false
    read-concurrency: 4
    skip-if-unchanged: true
    exclude:
      - ".tmp/"
      - ".cache/"
    exclude-file:
      - "{{ .chezmoi.homeDir }}/.restic/ignores/default"
    exclude-cloud-files: true
    group-by: "tags,host,paths"

  ## Checks the repository for errors
  #  https://creativeprojects.github.io/resticprofile/reference/profile/check/index.html
  check:
    schedule: "weekly"
    schedule-after-network-online: false
    schedule-ignore-on-battery: false
    schedule-ignore-on-battery-less-than: 20
    read-data: true
    with-cache: false

  ## Cache settings
  #  https://creativeprojects.github.io/resticprofile/reference/profile/cache/index.html
  cache:
    cleanup: false
    max-age: 30
    no-size: false

  no-error-on-warning: true

## Backup home dir
home:
  inherit: default
  default-command: backup

  backup:
    verbose: true
    source: "{{ .chezmoi.homeDir }}"
    read-concurrency: 4
    skip-if-unchanged: true
    exclude:
      - ".tmp/"
      - ".cache/"
    exclude-file:
      - "{{ .chezmoi.homeDir }}/.restic/ignores/default"
      - "{{ .chezmoi.homeDir }}/.restic/ignores/home"
    exclude-cloud-files: true
    group-by: "tags,host,paths"
    schedule: "0,6,12,18:00"  # every 6 hours
    schedule-permission: "user"
    schedule-priority: "standard"
    schedule-lock-mode: default
    schedule-lock-wait: 15m30s

  tags:
    - home
    - userland

