# yaml-language-server: $schema=https://creativeprojects.github.io/resticprofile/jsonschema/config.json
---
version: "1"

## Global commands apply to all profiles, unless overridden locally.
global:
  ## The command to run when no operation is passed to a resticprofile command.
  #  There are many options for default-command, like 'snapshots', 'backup', and 'prune'
  default-command: backup
  ## Initialize repository if it doesn't exist
  initialize: false
  ## Set CPU priority. Can affect backup speed, but uses less resources.
  #  https://creativeprojects.github.io/resticprofile/configuration/priority/index.html
  priority: low
  ## Restic won't start unless there are at least n MB free of RAM
  min-memory: 100

## Defaults that profiles can inherit with 'inherit: default'
default:
  ## Path to your restic repository
  repository: "local:/path/to/restic-repo"
  ## Path to a file containing the path to your restic repository
  # repository-file: "/path/to/restic_repo_file"
  ## Command to run to get password (i.e. read from vault)
  # password-command: ""
  ## Path to a file with your restic repository password
  password-file: "/path/to/restic_pw"

  ## Define backup retention policy
  #  https://creativeprojects.github.io/resticprofile/schedules/index.html
  forget:
    ## Keep n most recent backups
    keep-last: 2
    ## Keep n most reecent hourly backups
    keep-hourly: 24
    ## Keep n most recent daily backups
    keep-daily: 7
    ## Keep n most recent weekly backups
    keep-weekly: 4
    ## Skip cleanup if a profile has the 'forever' tag
    keep-tag:
      - forever
    ## Run prune operation on cleanup
    prune: true
    ## Tag can be a boolean or a custom set of tags.
    #  If 'true', copy tag set from backup
    tag:
      - resticprofile

  ## Backup operation defaults
  #  https://creativeprojects.github.io/resticprofile/reference/profile/backup/index.html
  backup:
    ## Disable verbose logging by default
    verbose: false
    ## Exclude other filesystems, don't cross filesystem boundaries & subvolumes
    one-file-system: false
    ## Set number of files that can be read concurrently
    read-concurrency: 2
    ## Skip snapshot creation if identical to parent snapshot
    skip-if-unchanged: true
    ## Path patterns to exclude.
    #  These can also be loaded from a file with exclude-file:
    #  You can use 'iexclude' to ignore cases in path names
    exclude:
      - ".tmp/"
      - ".cache/"
    ## Path(s) to restic exclude pattern files.
    #  You can use 'iexclude' to ignore path casing when searching for file
    exclude-file:
      - "/path/to/resticignore"
    ## On Windows, exclude online-only cloud files like Onedrive "files on demand"
    exclude-cloud-files: false
    ## Set size limit on individual files in the backup repository.
    #  i.e. 50K, 500M, 10G, 1T
    # exclude-if-larger-than: ""
    ## Comma-separated list of options for grouping snapshots.
    #  options are 'host', 'paths', 'tags', and can be combined with a comma,
    #  like: 'host,paths'
    group-by: "host,paths"

  ## Checks the repository for errors
  #  https://creativeprojects.github.io/resticprofile/reference/profile/check/index.html
  check:
    ## Run checks on a given schedule.
    #  Can be a string like 'weekly', a comma-separate list of timestamps like 10:00,14:00,
    #  or cron-like syntax like *-*-15 02:45 or Mon..Fri 00:30
    schedule: "weekly"
    ## If repository is remote, you can disable checks when network is offline
    schedule-after-network-online: false
    ## Don't do checks when running on battery
    schedule-ignore-on-battery: false
    ## Ignore when on battery and lower than n%
    schedule-ignore-on-battery-less-than: 20
    ## Read all data blobs
    read-data: true
    ## Use existing cache when 'true', only read uncached data from repository
    with-cache: false

  ## Cache settings
  #  https://creativeprojects.github.io/resticprofile/reference/profile/cache/index.html
  cache:
    ## Enable cache cleanup
    cleanup: false
    ## Set max age in days for cache directories
    max-age: 30
    ## Do not output size of cache directories
    no-size: false

  ## Ignore restic warnings when files cannot be read
  no-error-on-warning: true

## Define backup groups. Run resticprofile with -n <group_name>
#  to run all of the backups in that group
groups:
  basic:
    - home

  full_backup:
    - home

## Example backup /home/username directory
home:
  ## Inherit from the 'default' profile above
  inherit: default

  ## Define backup
  backup:
    ## Override 'verbose: false' from default
    verbose: true
    ## Set backup source(s)/target(s) (the path/paths to back up)
    source:
      - "/home/username"  # on Windows you can use C:\\Users\\username
    ## Path(s) to restic exclude patterns file(s)
    exclude-file:
      - "/path/to/resticignore"
      - "/path/to/restic_home_ignore"
  ## Set tags on the backup
  tags:
    - home
    - userland
  ## Check repository every 1st day of the month at 3:00
  check:
    schedule: "*-*-01 03:00"

## Example backup to Backblaze B2
b2_example:
  inherit: default
  repository: "b2:your-bucket:/restic-backups"
  ## Override default/global password file option
  #  Note: you should really use an env var or password-cmd for this
  password-file: "/path/to/b2_pw"
  backup:
    source:
      - "/some/path/to/backup"
    exclude-file:
      - "/path/to/restic_b2ignore"
  ## It's better to set these in environment variables, or to prefix the command
  #  with vars, i.e. B2_ACCOUNT_ID="..." B2_APPLICATION_KEY="..." resticprofile --name full_backup backup
  env:
    B2_ACCOUNT_ID: "..."
    B2_APPLICATION_KEY: "..."

    ## To load from the environment, use this template syntax
    #  https://creativeprojects.github.io/resticprofile/configuration/templates/index.html
    # B2_ACCOUNT_ID: "{{ .Env.MY_CUSTOM_ID }}"
    # B2_APPLICATION_KEY: "{{ .Env.MY_CUSTOM_KEY }}"

## Example rclone backup
rclone_backup:
  inherit: default
  repository: "rclone:your-remote:restic-backups"
  backup:
    source:
      - "/home/username"
  tags:
    - rclone
    - home
    - userland
  env:
    ## Set path to rclone.conf file. Looks in ~/.config/rclone/rclone.conf by default
    RCLONE_CONFIG: "{{ .Env.RCLONE_CONFIG | or \"~/.config/rclone/rclone.conf\" }}"

## Example pcloud backup
pcloud-backup:
  inherit: default
  repository: "rclone:pcloud:restic-backups"
  backup:
    source:
      - "/home/username"
  tags:
    - pcloud
    - home
    - userland
  env:
    RCLONE_CONFIG: "{{ .Env.RCLONE_CONFIG | or \"~/.config/rclone/rclone.pcloud.conf\" }}"

## Example SSH/SFTP backup
#  You should configure an entry in ~/.ssh/config and copy your keys in advance
sftp-backup:
  inherit: default
  ## You can parametrize this, i.e.
  #  repository: "sftp:{{ .Env.SFTP_USER }}@{{ .Env.SFTP_HOST }}:{{ .Env.SFTP_PATH }}"
  repository: "sftp:user@host:/path/to/restic-repo"
  backup:
    source:
      - "/home/username"
  tags:
    - sftp
  env:
    ## Optional SSH config file path or overrides.
    #  Using key-based auth may fail if this is not set.
    #  Specific to UNIX-like OSes (Linux, macOS).
    SSH_AUTH_SOCK: "{{ .Env.SSH_AUTH_SOCK }}"
