# yaml-language-server: $schema=https://creativeprojects.github.io/resticprofile/jsonschema/config.json
---
version: "1"

##
# Backups for paths that require root/sudo permissions
#
# Copy this file to a location like ~/privileged.profiles.yaml,
#  and use -c /path/to/privileged.profiles.yaml when running resticprofile.
##

global:
  default-command: backup
  initialize: true
  priority: low
  min-memory: 100
  scheduler: "auto"
  schedule-defaults:
    permission: "system"

## Combine multiple backups into a single 'group'
groups:
  privileged:
    - etc_ssh
    - etc_cron
    - etc_fstab

default:
  ## Path must exist. If you don't want to run resticprofile as root,
  #  make sure it's owned by the user running resticprofile, i.e.
  #  chmod 700 /opt/restic  (if repository is /opt/restic/repo)
  repository: "local:/opt/restic/repo"
  ## Create a password with:
  #    $> resticprofile generate --random-key $KEY_LENGTH > /path/to/restic.key
  password-file: ""
  default-command: snapshots
  initialize: false
  priority: low
  min-memory: 100

  ## Define backup retention policy
  #  https://creativeprojects.github.io/resticprofile/reference/profile/retention/index.html
  forget:
    keep-last: 2
    keep-hourly: 24
    keep-daily: 7
    keep-weekly: 4
    keep-tag:
      - forever
    prune: true

  ## Define pruning policy
  #  https://creativeprojects.github.io/resticprofile/reference/profile/prune/index.html
  prune:
    schedule: "weekly"
    schedule-permission: "auto"

  ## Backup operation defaults
  #  https://creativeprojects.github.io/resticprofile/reference/profile/backup/index.html
  backup:
    verbose: false
    one-file-system: false
    read-concurrency: 4
    skip-if-unchanged: true
    exclude:
      - ".tmp/"
      - ".cache/"
    exclude-file:
      - "~/.restic/ignores/default"
    exclude-cloud-files: true
    group-by: "tags,host,paths"

  ## Checks the repository for errors
  #  https://creativeprojects.github.io/resticprofile/reference/profile/check/index.html
  check:
    schedule: "weekly"
    schedule-after-network-online: false
    schedule-ignore-on-battery: false
    schedule-ignore-on-battery-less-than: 20
    read-data: true
    with-cache: false

  ## Cache settings
  #  https://creativeprojects.github.io/resticprofile/reference/profile/cache/index.html
  cache:
    cleanup: true
    max-age: 30
    no-size: false

  no-error-on-warning: true

## Backup /etc/ssh
etc_ssh:
  inherit: default

  backup:
    source: "/etc/ssh"
    schedule: "weekly"
    schedule-permission: "system"
    schedule-priority: "background"
    schedule-lock-mode: default
    schedule-lock-wait: 15m30s

  tags:
    - ssh
    - privileged

## Backup /etc/cron*
etc_cron:
  inherit: default

  backup:
    source:
      - /etc/cron.d
      - /etc/cron.daily
      - /etc/cron.hourly
      - /etc/cron.monthly
      - /etc/crontab
    schedule: "daily"
    schedule-permission: "system"
    schedule-priority: "background"

  tags:
    - cron
    - privileged

## Backup /etc/fstab
etc_fstab:
  inherit: default

  backup:
    source: "/etc/fstab"
    schedule: "daily"
    schedule-permission: "system"
    schedule-priority: "background"

  tags:
    - fstab
    - privileged
